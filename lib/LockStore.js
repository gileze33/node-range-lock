"use strict";
var orm = require('orm');
var uuid = require('uuid');
var debug = require('debug')('range-lock');
var entities_1 = require('./LockStore/entities');
var LockStore = function (url) {
    this.url = url;
    this.ready = false;
    this.connecting = false;
    var store = this;
    this.connect(function () {
        debug('LockStore connected to data store at ' + url);
        setInterval(function () {
            store.tidy();
        }, 30000);
    });
};
LockStore.prototype.connect = function (cb) {
    if (this.ready) {
        return cb();
    }
    this.connectQueue = this.connectQueue || [];
    if (this.connecting) {
        return this.connectQueue.push(cb);
    }
    this.connecting = true;
    var done = function () {
        cb();
        if (store.connectQueue.length > 0) {
            for (var i = 0; i < store.connectQueue.length; i++) {
                store.connectQueue[i]();
            }
        }
    };
    var store = this;
    orm.connect(this.url, function (err, db) {
        if (err) {
            console.log('FATAL: range-lock LockStore failed to connect to data store');
            throw err;
        }
        db.driver.db.on('end', function (err) {
            throw new Error('lock-store db connection lost');
        });
        store.db = db;
        entities_1.default.define(store.db, store.db.models, function (err) {
            if (err) {
                console.log('FATAL: range-lock LockStore connected but failed to init data store');
                throw err;
            }
            store.ready = true;
            store.connecting = false;
            done();
        });
    });
};
var generateIntersectsSQL = function generateIntersectsSQL(start, end) {
    start.value = start.value * 1;
    end.value = end.value * 1;
    return '((`' + start.field + '` <= ' + start.value + ' AND `' + end.field + '` >= ' + end.value + ') OR (`' + start.field + '` >= ' + start.value + ' AND `' + start.field + '` <= ' + end.value + ' AND `' + end.field + '` >= ' + end.value + ') OR (`' + start.field + '` <= ' + start.value + ' AND `' + end.field + '` >= ' + start.value + ' AND `' + end.field + '` <= ' + end.value + ') OR (`' + start.field + '` >= ' + start.value + ' AND `' + end.field + '` <= ' + end.value + '))';
};
LockStore.prototype.find = function find(key, from, to, cb) {
    var store = this;
    var now = new Date().getTime();
    store.db.models.lock.find({
        key: key,
        expiry: orm.gt(now)
    }).where(generateIntersectsSQL({
        field: 'from',
        value: from
    }, {
        field: 'to',
        value: to
    })).run(function (err, results) {
        if (err) {
            return cb(err);
        }
        debug('find for key=' + key + ', from=' + from + ', to=' + to + ' got ' + results.length + ' results');
        cb(null, results);
    });
};
LockStore.prototype.create = function create(key, from, to, data, ttl, cb) {
    var store = this;
    var createLock = function createLock() {
        var now = new Date().getTime();
        var nowStr = (now + '');
        var lockID = nowStr.substr(-5) + '-' + nowStr.substr(-10, 5) + '-' + uuid.v4();
        store.db.models.lock.count({
            id: lockID
        }, function (err, count) {
            if (err) {
                return cb(err);
            }
            if (count > 0) {
                debug('found conflict for lock id ' + lockID);
                return createLock();
            }
            var obj = {
                key: key,
                from: from,
                to: to,
                expiry: now + ttl,
                data: data,
                id: null
            };
            debug('creating lock with ID ' + lockID, obj);
            obj.id = lockID;
            store.db.models.lock.create(obj, function (err, result) {
                if (cb)
                    cb(err, result);
            });
        });
    };
    createLock();
};
LockStore.prototype.get = function find(key, lockID, cb) {
    var store = this;
    var now = new Date().getTime();
    store.db.models.lock.find({
        key: key,
        id: lockID,
        expiry: orm.gt(now)
    }).run(function (err, results) {
        if (err) {
            return cb(err);
        }
        if (results.length === 0) {
            debug('get for key=' + key + ', id=' + lockID + ' found no valid locks');
            return cb(null, null);
        }
        var lock = results[0];
        debug('get for key=' + key + ', id=' + lockID + ' found a valid lock', lock);
        cb(null, lock);
    });
};
LockStore.prototype.remove = function remove(key, lockID, cb) {
    var store = this;
    debug('deleting lock with key=' + key + ', id=' + lockID);
    store.db.models.lock.find({
        key: key,
        id: lockID
    }).remove(function (err, result) {
        if (cb)
            cb(err, result);
    });
};
LockStore.prototype.tidy = function tidy(cb) {
    var store = this;
    var now = new Date().getTime();
    store.db.models.lock.count({
        expiry: orm.lte(now)
    }, function (err, count) {
        if (err) {
            if (cb)
                cb(err);
            debug('tidy got error', err);
            return;
        }
        debug('tidy found ' + count + ' items to remove');
        store.db.models.lock.find({
            expiry: orm.lte(now)
        }).remove(function (err, result) {
            if (cb)
                cb(err);
            debug('tidy completed');
        });
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = LockStore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTG9ja1N0b3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiTG9ja1N0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDekIsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzNCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUMzQyx5QkFBcUIsc0JBQXNCLENBQUMsQ0FBQTtBQUU1QyxJQUFJLFNBQVMsR0FBRyxVQUFTLEdBQUc7SUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDZixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNuQixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUV4QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUNULEtBQUssQ0FBQyx1Q0FBdUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUdyRCxXQUFXLENBQUM7WUFDUixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ2IsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUM7QUFFRixTQUFTLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxVQUFTLEVBQUU7SUFDckMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDWixNQUFNLENBQUMsRUFBRSxFQUFFLENBQUM7SUFDaEIsQ0FBQztJQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUM7SUFFNUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLElBQUksQ0FB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